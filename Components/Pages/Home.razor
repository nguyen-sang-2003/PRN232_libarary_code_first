@page "/"
@using LibararyWebApplication.DTO.Cuong
@inject HttpClient Http
@using Newtonsoft.Json
@rendermode InteractiveServer
@inject NavigationManager Navigation

<!DOCTYPE html>
<html lang="en">
<head>
    <!-- basic -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- mobile metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <!-- site metas -->
    <title>memorial books</title>
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- bootstrap css -->
    <link rel="stylesheet" href="/TemplateLibraryHomePage/css/bootstrap.min.css">
    <!-- style css -->
    <link rel="stylesheet" href="/TemplateLibraryHomePage/css/style.css">
    <!-- Responsive-->
    <link rel="stylesheet" href="/TemplateLibraryHomePage/css/responsive.css">
    <!-- fevicon -->
    <link rel="icon" href="/TemplateLibraryHomePage/images/fevicon.png" type="image/gif" />
    <!-- Scrollbar Custom CSS -->
    <link rel="stylesheet" href="/TemplateLibraryHomePage/css/jquery.mCustomScrollbar.min.css">
    <!-- Tweaks for older IEs-->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]-->


</head>
<!-- body -->
<body class="main-layout home_page">
    <!-- loader  -->
    <div class="loader_bg">
        <div class="loader"><img src="/TemplateLibraryHomePage/images/loading.gif" alt="#" /></div>
    </div>
    <!-- end loader -->
    <!-- header -->
    <header>
        <!-- header inner -->
        <div class="header">
            <div class="container">
                <div class="row">
                    <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 col logo_section">
                        <div class="full">
                            <div class="center-desk">
                                <div class="logo"> <a href="index.html"><img src="/TemplateLibraryHomePage/images/logo.png" alt="#"></a> </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-9 col-lg-9 col-md-9 col-sm-9">
                        <div class="menu-area">
                            <div class="limit-box">
                                <nav class="main-menu">
                                    <ul class="menu-area-main">
                                        <li class="active"> <a href="index.html">Home</a> </li>
                                        <li> <a href="about.html">About us</a> </li>
                                        <li><a href="books.html">Our Books</a></li>
                                        <li><a href="library.html">library</a></li>
                                        <li><a href="contact.html">Contact us</a></li>
                                        <li class="mean-last"> <a href="#"><img src="/TemplateLibraryHomePage/images/search_icon.png" alt="#" /></a> </li>
                                        <li class="mean-last"> <a href="#"><img src="/TemplateLibraryHomePage/images/top-icon.png" alt="#" /></a> </li>
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- end header inner -->
    </header>
    <!-- end header -->
    <section class="slider_section">
        <div id="myCarousel" class="carousel slide banner-main" data-ride="carousel">
            <div class="carousel-inner">
                <div class="carousel-item active">
                    <img class="first-slide" src="/TemplateLibraryHomePage/images/banner.jpg" alt="First slide">
                    <div class="container">
                        <div class="carousel-caption relative">
                            <h1>The Best Libraries That<br> Every Book Lover Must<br> Visit!</h1>
                            <p>adipiscing elit, sed do eiusmod tempor incididunt ut<br> labore et dolore magna aliqua. Ut enim ad minim<br> veniam, quis nostrud exercitation </p>
                            <div class="button_section"> <a class="main_bt" href="#">Read More</a>  </div>
                            <ul class="locat_icon">
                                <li> <a href="#"><img src="/TemplateLibraryHomePage/icon/facebook.png"></a></li>
                                <li> <a href="#"><img src="/TemplateLibraryHomePage/icon/Twitter.png"></a></li>
                                <li> <a href="#"><img src="/TemplateLibraryHomePage/icon/linkedin.png"></a></li>
                                <li> <a href="#"><img src="/TemplateLibraryHomePage/icon/instagram.png"></a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="carousel-item">
                    <img class="second-slide" src="/TemplateLibraryHomePage/images/banner.jpg" alt="Second slide">
                    <div class="container">
                        <div class="carousel-caption relative">
                            <h1>The Best Libraries That<br> Every Book Lover Must<br> Visit!</h1>
                            <p>adipiscing elit, sed do eiusmod tempor incididunt ut<br> labore et dolore magna aliqua. Ut enim ad minim<br> veniam, quis nostrud exercitation </p>
                            <div class="button_section"> <a class="main_bt" href="#">Read More</a>  </div>
                            <ul class="locat_icon">
                                <li> <a href="#"><img src="/TemplateLibraryHomePage/icon/facebook.png"></a></li>
                                <li> <a href="#"><img src="/TemplateLibraryHomePage/icon/Twitter.png"></a></li>
                                <li> <a href="#"><img src="/TemplateLibraryHomePage/icon/linkedin.png"></a></li>
                                <li> <a href="#"><img src="/TemplateLibraryHomePage/icon/instagram.png"></a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="carousel-item">
                    <img class="third-slide" src="/TemplateLibraryHomePage/images/banner.jpg" alt="Third slide">
                    <div class="container">
                        <div class="carousel-caption relative">
                            <h1>The Best Libraries That<br> Every Book Lover Must<br> Visit!</h1>
                            <p>adipiscing elit, sed do eiusmod tempor incididunt ut<br> labore et dolore magna aliqua. Ut enim ad minim<br> veniam, quis nostrud exercitation </p>
                            <div class="button_section"> <a class="main_bt" href="#">Read More</a>  </div>
                            <ul class="locat_icon">
                                <li> <a href="#"><img src="/TemplateLibraryHomePage/icon/facebook.png"></a></li>
                                <li> <a href="#"><img src="/TemplateLibraryHomePage/icon/Twitter.png"></a></li>
                                <li> <a href="#"><img src="/TemplateLibraryHomePage/icon/linkedin.png"></a></li>
                                <li> <a href="#"><img src="/TemplateLibraryHomePage/icon/instagram.png"></a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <a class="carousel-control-prev" href="#myCarousel" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#myCarousel" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>
        </div>
    </section>
    <!-- about -->
    <div class="about">
        <div class="container">
            <div class="row">
                <div class="col-md-10 offset-md-1">
                    <div class="aboutheading">
                        <h2>About <strong class="black">Us</strong></h2>
                        <span>adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris</span>
                    </div>
                </div>
            </div>
            <div class="row border">
                <div class="col-xl-7 col-lg-7 col-md-12 col-sm-12">
                    <div class="about-box">
                        <p> consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore</p>
                        <a href="#">Read More</a>
                    </div>
                </div>
                <div class="col-xl-5 col-lg-5 col-md-12 col-sm-12">
                    <div class="about-box">
                        <figure><img src="/TemplateLibraryHomePage/images/about.png" alt="img" /></figure>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- end about -->
    <!-- Library -->
    <div class="Library">
        <div class="container">
            <div class="row">
                <div class="col-md-10 offset-md-1">
                    <div class="titlepage">
                        <h2>Our <strong class="black">Library </strong></h2>
                        <span>adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="bg">
            <div class="container">
                <div class="row">
                    <div class="col-md-10 offset-md-1">
                        <div class="Library-box">
                            <figure><img src="/TemplateLibraryHomePage/images/Library-.jpg" alt="#" /></figure>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <div class="read-more">
                        <a href="#">Read More</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- end Library -->
    <!--Books -->
    <div class="Books">
        <div class="container">
            <div class="row">
                <div class="col-md-10 offset-md-1">
                    <div class="titlepage">
                        <h2>Our <strong class="black">Books </strong></h2>
                        <span>adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris</span>
                    </div>
                </div>
            </div>

            <div class="container-fluid mt-4">
                <div class="row">
                    <!-- Left side: Search and Categories -->
                    <div class="col-md-4 mb-4">
                        <div class="card mb-4">
                            <div class="card-body">
                                <h5 class="card-title">Search</h5>
                                <input type="text" id="searchInput" class="form-control" placeholder="Search books...">
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Categories</h5>

                                <script>
                                    @{
                                        string category_json = JsonConvert.SerializeObject(categories);
                                    }
                                    var category_arr = @(category_json);
                                </script>
                                <ul class="list-group" id="categoryList">
                                    @if (categories != null)
                                    {
                                        @foreach (var cate in categories)
                                        {
                                            <button class="list-group-item list-group-item-action text-start"
                                                   @onclick="() => {
                                                       SelectedCategoryId = cate.Id;
                                                       LoadBooksByCategoryId(cate.Id);
                                                       Console.WriteLine(cate.Id);
                                                   }"
                                                    >
                                                @cate.Name
                                            </button>
                                        }
                                    }
                                    else
                                    {
                                        <li class="list-group-item"><em>Loading...</em></li>
                                    }
                                </ul>

                            </div>
                        </div>
                    </div>

                    <!-- Right side: Book List -->

                    <div class="col-md-8">
                        @if (books == null)
                        {
                            <p><em>Loading...</em></p>
                        }
                        else
                        {
                            <div class="row">
                                @foreach (var book in books)
                                {
                                    <div class="col-md-4 mb-3">
                                        <div class="card h-100">
                                            <img src="data:image/png;base64,@book.ImageBase64" class="card-img-top" alt="@book.Title" />
                                            <div class="card-body">
                                                <h5 class="card-title">
                                                    <a href="/book/@book.Id" class="text-decoration-none text-primary">@book.Title</a>
                                                </h5>
                                                <p class="card-text">
                                                    Author: @book.AuthorName <br />
                                                    Published: @book.PublishedDate.ToShortDateString() <br />
                                                    Available: @book.AvailableCopies / @book.TotalCopies
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        }
                    </div>

                </div>
            </div>

        </div>
    </div>
    <!-- end Books -->
    <!-- Contact -->
    <div class="Contact">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <div class="titlepage3">
                        <h2>Contact</h2>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12">
                    <form>
                        <div class="row">
                            <div class="col-xl-3 col-lg-3 col-md-3 col-sm-12">
                                <input class="form-control" placeholder="Name" type="Name">
                            </div>
                            <div class="col-xl-3 col-lg-3 col-md-3 col-sm-12">
                                <input class="form-control" placeholder="Phone Number" type="Phone Number">
                            </div>
                            <div class="col-xl-3 col-lg-3 col-md-3 col-sm-12">
                                <input class="form-control" placeholder="Email" type="Email">
                            </div>
                            <div class="col-xl-3 col-lg-3 col-md-3 col-sm-12">
                                <textarea class="textarea" placeholder="Message">Message</textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <button class="send-btn">Send</button>
            </div>
        </div>
    </div>
    <!-- end Contact -->
    <!-- footer -->
    <footer>
        <div class="footer">
            <div class="container">
                <div class="row pdn-top-30">
                    <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12">
                        <div class="Follow">
                            <h3>Follow Us</h3>
                        </div>
                        <ul class="location_icon">
                            <li> <a href="#"><img src="/TemplateLibraryHomePage/icon/facebook.png"></a></li>
                            <li> <a href="#"><img src="/TemplateLibraryHomePage/icon/Twitter.png"></a></li>
                            <li> <a href="#"><img src="/TemplateLibraryHomePage/icon/linkedin.png"></a></li>
                            <li> <a href="#"><img src="/TemplateLibraryHomePage/icon/instagram.png"></a></li>
                        </ul>
                    </div>
                    <div class="col-xl-8 col-lg-8 col-md-8 col-sm-12">
                        <div class="Follow">
                            <h3>Newsletter</h3>
                        </div>
                        <input class="Newsletter" placeholder="Enter your email" type="Enter your email">
                        <button class="Subscribe">Subscribe</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="copyright">
            <div class="container">
                <p>Copyright 2019 All Right Reserved By <a href="https://html.design/">Free html Templates</a></p>
            </div>
        </div>
    </footer>
    <!-- end footer -->
    <!-- Javascript files-->

    <!-- Search Book by title-->

    <script>
        document.getElementById("searchInput").addEventListener("input", function () {
            const searchTerm = this.value;

            fetch(`/api/cuong/books?search=${encodeURIComponent(searchTerm)}`)
                .then(response => response.json())
                .then(data => {
                    const bookListContainer = document.querySelector(".col-md-8 .row");
                    bookListContainer.innerHTML = ""; // Clear old books

                    if (data.length === 0) {
                        bookListContainer.innerHTML = "<p>No books found.</p>";
                        return;
                    }

                    data.forEach(book => {
                        const bookCard = `
                                <div class="col-md-4 mb-3">
                                    <div class="card h-100">
                                        <img src="data:image/png;base64,${book.imageBase64}" class="card-img-top" alt="${book.title}" />
                                        <div class="card-body">
                                            <h5 class="card-title">${book.title}</h5>
                                            <p class="card-text">
                                                Author: ${book.authorName} <br />
                                                Published: ${new Date(book.publishedDate).toLocaleDateString()} <br />
                                                Available: ${book.availableCopies} / ${book.totalCopies}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            `;
                        bookListContainer.insertAdjacentHTML('beforeend', bookCard);
                    });
                })
                .catch(error => {
                    console.error("Search error:", error);
                });
        });

    </script>

    <script src="/TemplateLibraryHomePage/js/jquery.min.js"></script>
    <script src="/TemplateLibraryHomePage/js/popper.min.js"></script>
    <script src="/TemplateLibraryHomePage/js/bootstrap.bundle.min.js"></script>
    <script src="/TemplateLibraryHomePage/js/jquery-3.0.0.min.js"></script>
    <script src="/TemplateLibraryHomePage/js/plugin.js"></script>
    <!-- sidebar -->
    <script src="/TemplateLibraryHomePage/js/jquery.mCustomScrollbar.concat.min.js"></script>
    <script src="/TemplateLibraryHomePage/js/custom.js"></script>
</body>
</html>
@code {
    private List<BookDto>? books;
    private List<CategoryDto>? categories;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            books = await Http.GetFromJsonAsync<List<BookDto>>($"{Navigation.BaseUri}api/cuong/books");
            @* categories = await Http.GetFromJsonAsync<List<CategoryDto>>($"{Navigation.BaseUri}api/categories"); *@
        }
        catch (Exception ex)
        {
            Console.Error.WriteLine($"Failed to fetch data: {ex.Message}");
            books = null;
            categories = null;
        }
    }

    void on_category_button_click()
    {
        Console.WriteLine("button_click");
    }

    public int SelectedCategoryId { get; set; }

    private async Task LoadBooksByCategoryId(int categoryId)
    {
        try
        {
            // TODO: cuong
            books = await Http.GetFromJsonAsync<List<BookDto>>($"{Navigation.BaseUri}api/categories/{categoryId}/books");
        }
        catch (Exception ex)
        {
            Console.Error.WriteLine($"Failed to fetch books by category: {ex.Message}");
            books = null;
        }
    }
}
